"use strict";function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}!function(t){var e=function(e){function s(t){var s;return(s=e.call(this)||this)._input_style=Object.assign({position:"absolute",background:"none",border:"none",outline:"none",transformOrigin:"0 0",lineHeight:"0"},t.input),t.box?s._box_generator="function"==typeof t.box?t.box:new i(t.box):s._box_generator=null,s._box_cache={},s._previous={},s._dom_added=!1,s._dom_visible=!0,s._placeholder="",s._placeholderColor=11119017,s._createDOMInput(),s.substituteText=!0,s._setState("DEFAULT"),s._addListeners(),s}_inheritsLoose(s,e);var o=s.prototype;return o.focus=function(){this._substituted&&!this.dom_visible&&this._setDOMInputVisible(!0),this._dom_input.focus()},o.setInputStyle=function(t,e){this._input_style[t]=e,this._dom_input.style[t]=e,!this._substituted||"fontFamily"!==t&&"fontSize"!==t||this._updateFontMetrics(),this._last_renderer&&this._update()},o.destroy=function(t){this.destroyBoxCache(),e.prototype.destroy.call(this,t)},o._createDOMInput=function(){for(var t in this._dom_input=document.createElement("input"),this._dom_input.type="text",this._input_style)this._dom_input.style[t]=this._input_style[t]},o._addListeners=function(){this.on("added",this._onAdded.bind(this)),this.on("removed",this._onRemoved.bind(this)),this._dom_input.addEventListener("keydown",this._onInputKeyDown.bind(this)),this._dom_input.addEventListener("input",this._onInputInput.bind(this)),this._dom_input.addEventListener("keyup",this._onInputKeyUp.bind(this)),this._dom_input.addEventListener("focus",this._onFocused.bind(this)),this._dom_input.addEventListener("blur",this._onBlurred.bind(this))},o._onInputKeyDown=function(t){this.emit("keydown",t.keyCode)},o._onInputInput=function(t){this.emit("input",this.text),this._substituted&&this._updateSubstitution()},o._onInputKeyUp=function(t){this.emit("keyup",t.keyCode)},o._onFocused=function(){this._setState("FOCUSED")},o._onBlurred=function(){this._setState("DEFAULT")},o._onAdded=function(){document.body.appendChild(this._dom_input),this._dom_input.style.display="none",this._dom_added=!0},o._onRemoved=function(){document.body.removeChild(this._dom_input),this._dom_added=!1},o._setState=function(t){this.state=t,this._updateBox(),this._substituted&&this._updateSubstitution()},o.renderWebGL=function(t){e.prototype.renderWebGL.call(this,t),this._renderInternal(t)},o.renderCanvas=function(t){e.prototype.renderCanvas.call(this,t),this._renderInternal(t)},o.render=function(t){e.prototype.render.call(this,t),this._renderInternal(t)},o._renderInternal=function(t){this._resolution=t.resolution,this._last_renderer=t,this._canvas_bounds=this._getCanvasBounds(),this._needsUpdate()&&this._update()},o._update=function(){this._updateDOMInput(),this._substituted&&this._updateSurrogate(),this._updateBox()},o._updateBox=function(){this._box_generator&&(this._needsNewBoxCache()&&this._buildBoxCache(),this.state==this._previous.state&&this._box==this._box_cache[this.state]||(this._box&&this.removeChild(this._box),this._box=this._box_cache[this.state],this.addChildAt(this._box,0),this._previous.state=this.state))},o._updateSubstitution=function(){"FOCUSED"===this.state?(this._dom_visible=!0,this._surrogate.visible=0===this.text.length):(this._dom_visible=!1,this._surrogate.visible=!0),this._updateDOMInput(),this._updateSurrogate()},o._updateDOMInput=function(){this._canvas_bounds&&(this._dom_input.style.top=this._canvas_bounds.top+"px",this._dom_input.style.left=this._canvas_bounds.left+"px",this._dom_input.style.transform=this._pixiMatrixToCSS(this._getDOMRelativeWorldTransform()),this._dom_input.style.opacity=this.worldAlpha,this._setDOMInputVisible(this.worldVisible&&this._dom_visible),this._previous.canvas_bounds=this._canvas_bounds,this._previous.world_transform=this.worldTransform.clone(),this._previous.world_alpha=this.worldAlpha,this._previous.world_visible=this.worldVisible)},o._needsUpdate=function(){return!this._comparePixiMatrices(this.worldTransform,this._previous.world_transform)||!this._compareClientRects(this._canvas_bounds,this._previous.canvas_bounds)||this.worldAlpha!=this._previous.world_alpha||this.worldVisible!=this._previous.world_visible},o._needsNewBoxCache=function(){var t=this._getDOMInputBounds();return!this._previous.input_bounds||t.width!=this._previous.input_bounds.width||t.height!=this._previous.input_bounds.height},o._createSurrogate=function(){this._surrogate_hitbox=new t.Graphics,this._surrogate_hitbox.alpha=0,this._surrogate_hitbox.interactive=!0,this._surrogate_hitbox.cursor="text",this._surrogate_hitbox.on("pointerdown",this._onSurrogateFocus.bind(this)),this.addChild(this._surrogate_hitbox),this._surrogate_mask=new t.Graphics,this.addChild(this._surrogate_mask),this._surrogate=new t.Text("",{}),this.addChild(this._surrogate),this._surrogate.mask=this._surrogate_mask,this._updateFontMetrics(),this._updateSurrogate()},o._updateSurrogate=function(){var t=this._deriveSurrogatePadding(),e=this._getDOMInputBounds();this._surrogate.style=this._deriveSurrogateStyle(),this._surrogate.style.padding=Math.max.apply(Math,t),this._surrogate.y=(e.height-this._surrogate.height)/2,this._surrogate.x=t[3],this._surrogate.text=this._deriveSurrogateText(),this._updateSurrogateHitbox(e),this._updateSurrogateMask(e,t)},o._updateSurrogateHitbox=function(t){this._surrogate_hitbox.clear(),this._surrogate_hitbox.beginFill(0),this._surrogate_hitbox.drawRect(0,0,t.width,t.height),this._surrogate_hitbox.endFill(),this._surrogate_hitbox.interactive=!this._disabled},o._updateSurrogateMask=function(t,e){this._surrogate_mask.clear(),this._surrogate_mask.beginFill(0),this._surrogate_mask.drawRect(e[3],0,t.width-e[3]-e[1],t.height),this._surrogate_mask.endFill()},o._destroySurrogate=function(){this._surrogate&&(this.removeChild(this._surrogate),this.removeChild(this._surrogate_hitbox),this._surrogate.destroy(),this._surrogate_hitbox.destroy(),this._surrogate=null,this._surrogate_hitbox=null)},o._onSurrogateFocus=function(){this._setDOMInputVisible(!0),setTimeout(this._ensureFocus.bind(this),10)},o._ensureFocus=function(){this._hasFocus()||this.focus()},o._deriveSurrogateStyle=function(){var e=new t.TextStyle;for(var i in this._input_style)switch(i){case"color":e.fill=this._input_style.color;break;case"fontFamily":case"fontSize":case"fontWeight":case"fontVariant":case"fontStyle":e[i]=this._input_style[i]}return 0===this._dom_input.value.length&&(e.fill=this._placeholderColor),e},o._deriveSurrogatePadding=function(){if(this._input_style.padding&&this._input_style.padding.length>0){var t=this._input_style.padding.trim().split(" ");if(1==t.length){var e=parseFloat(t[0]);return[e,e,e,e]}if(2==t.length){var i=parseFloat(t[0]),s=parseFloat(t[1]);return[i,s,i,s]}if(4==t.length)return t.map(function(t){return parseFloat(t)})}return[0,0,0,0]},o._deriveSurrogateText=function(){return 0===this._dom_input.value.length?this._placeholder:this._dom_input.value},o._updateFontMetrics=function(){var e=this._deriveSurrogateStyle().toFontString();this._font_metrics=t.TextMetrics.measureFont(e)},o._buildBoxCache=function(){this._destroyBoxCache();var t=["DEFAULT","FOCUSED","DISABLED"],e=this._getDOMInputBounds();for(var i in t)this._box_cache[t[i]]=this._box_generator(e.width,e.height,t[i]);this._previous.input_bounds=e},o._destroyBoxCache=function(){for(var t in this._box&&(this.removeChild(this._box),this._box=null),this._box_cache)this._box_cache[t].destroy(),this._box_cache[t]=null,delete this._box_cache[t]},o._hasFocus=function(){return document.activeElement===this._dom_input},o._setDOMInputVisible=function(t){this._dom_input.style.display=t?"block":"none"},o._getCanvasBounds=function(){var t=this._last_renderer.view.getBoundingClientRect(),e={top:t.top,left:t.left,width:t.width,height:t.height};return e.left+=window.scrollX,e.top+=window.scrollY,e},o._getDOMInputBounds=function(){var t=!1;this._dom_added||(document.body.appendChild(this._dom_input),t=!0);var e=this._dom_input.style.transform,i=this._dom_input.style.display;this._dom_input.style.transform="",this._dom_input.style.display="block";var s=this._dom_input.getBoundingClientRect();return this._dom_input.style.transform=e,this._dom_input.style.display=i,t&&document.body.removeChild(this._dom_input),s},o._getDOMRelativeWorldTransform=function(){var t=this._last_renderer.view.getBoundingClientRect(),e=this.worldTransform.clone();return e.scale(this._resolution,this._resolution),e.scale(t.width/this._last_renderer.width,t.height/this._last_renderer.height),e},o._pixiMatrixToCSS=function(t){return"matrix("+[t.a,t.b,t.c,t.d,t.tx,t.ty].join(",")+")"},o._comparePixiMatrices=function(t,e){return!(!t||!e)&&(t.a==e.a&&t.b==e.b&&t.c==e.c&&t.d==e.d&&t.tx==e.tx&&t.ty==e.ty)},o._compareClientRects=function(t,e){return!(!t||!e)&&(t.left==e.left&&t.top==e.top&&t.width==e.width&&t.height==e.height)},_createClass(s,[{key:"substituteText",get:function(){return this._substituted},set:function(t){this._substituted!=t&&(this._substituted=t,t?(this._createSurrogate(),this._dom_visible=!1):(this._destroySurrogate(),this._dom_visible=!0),this.placeholder=this._placeholder,this._update())}},{key:"placeholder",get:function(){return this._placeholder},set:function(t){this._placeholder=t,this._substituted?(this._updateSurrogate(),this._dom_input.placeholder=""):this._dom_input.placeholder=t}},{key:"disabled",get:function(){return this._disabled},set:function(t){this._disabled=t,this._dom_input.disabled=t,this._setState(t?"DISABLED":"DEFAULT")}},{key:"text",get:function(){return this._dom_input.value},set:function(t){this._dom_input.value=t,this._substituted&&this._updateSurrogate()}}]),s}(t.Container);function i(e){if((e=e||{fill:13421772}).default)e.focused=e.focused||e.default,e.disabled=e.disabled||e.default;else{var i=e;(e={}).default=e.focused=e.disabled=i}return function(i,s,o){var n=e[o.toLowerCase()],r=new t.Graphics;return n.fill&&r.beginFill(n.fill),n.stroke&&r.lineStyle(n.stroke.width||1,n.stroke.color||0,n.stroke.alpha||1),n.rounded?r.drawRoundedRect(0,0,i,s,n.rounded):r.drawRect(0,0,i,s),r.endFill(),r.closePath(),r}}t.TextInput=e}(PIXI);